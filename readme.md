# plc_training_factory_24v_1200

Проект plc_training_factory_24v_1200 предназначен для демонстрации работы манипулятора с вакуумным захватным устройством (VGR) в составе макета [fischertechnik 536634 Simulation Factory 24v](http://pacpac.ru/product/536634-simulation-factory-24v/). Проект создан на базе кода из репозитария [fischertechnik Training Factory Industry 4.0 24V](https://github.com/fischertechnik/plc_training_factory_24v). Для управления используется стойка СТ350 и контроллер SIMATIC S7-1214C с комплектом модулей ввода-вывода.

## <a name="requirements"></a>Системные требования
* TIA Portal – 16

## <a name="prog-structure">Структура программы

### Организационные блоки:

#### Main [OB1]
Основной организационный блок, который вызывает функциональные блоки движения осей манипулятора и основного алгоритма движения манипулятора. Выполняется в фоновом режиме;

#### Cyclic interrupt [OB30]
Организационный блок вызывает функциональные блоки, отвечающие за обработку сигналов от энкодеров серводвигателей. Выполняется периодически с периодом T = 5 мс;

#### Startup [OB100]
Организационный блок Предназначен для перевода конечного автомата алгоритма в начальное состояние. Выполняется однократно при старте ПЛК.

### Функциональные блоки:

#### FB_Axis [FB22]
Управляет позиционированием одной оси манипулятора. Принимает на вход команды перемещения в исходное положение и в заданную позицию. Для каждой оси используется отдельный экземплярный блок данных. Блок вызывается периодически в функциональных блоках PRG_VGR_Axis_horizontal [FB4], PRG_VGR_Axis_rotate [FB5] и PRG_VGR_Axis_vertical [FB1];

#### PRG_VGR_Axis_vertical_Act_Pos [FB28]
Блок обработки сигналов от энкодера двигателя вертикальной оси. Читает текущее значение из регистра счетчика HSC и записывает его в соответствующее поле данных;

#### PRG_VGR_Axis_horizontal_Act_Pos [FB29]
Блок обработки сигналов от энкодера двигателя горизонтальной оси;

#### PRG_VGR_Axis_rotate_Act_Pos [FB30]
Блок обработки сигналов от энкодера двигателя привода платформы;

#### PRG_VGR_Axis_horizontal [FB4]
Вызывает функциональный блок FB_Axis [FB22], который формирует сигналы управления приводом горизонтальной оси;

#### PRG_VGR_Axis_vertical [FB1]
Вызывает функциональный блок FB_Axis [FB22], который формирует сигналы управления приводом вертикальной оси;

#### PRG_VGR_Axis_rotate [FB5]
Вызывает функциональный блок FB_Axis [FB22], который формирует сигналы управления приводом горизонтальной оси;

#### PRG_VGR_Demo [FB3]
Главная программа манипулятора. Выполняет циклограмму перемещений, которая реализована в виде конечного автомата. Блок вызывается в Main [OB1].


## <a name="prog-structure">Описание алгоритма PRG_VGR_Demo [FB3]

1. Движение осей манипулятора в исходное положение (парковка в исходное положение);
1. Выдвинуть механизм загрузки заготовок в печь технологического участка;
1. Переместить вакуумный захват манипулятора к накопителю белых изделий;
1. Захватить изделие;
1. Переместить изделие на механизм загрузки в печь участка термической обработки;
1. Сбросить изделие;
1. Захватить изделие;
1. Переместить изделие в накопитель белых изделий;
1. Сбросить изделие;
1. Повтор цикла с п. 3.

## Конфигурация ПЛК

В проекте используется ПЛК SIMATIC серии S7-1200 в следующем составе:

|Название|Артикул|Версия ПО|Кол-во|
| :-: | :-: | :-: | :-: |
|CPU 1214C DC/DC/DC|6ES7 214-1AG40-0XB0|V4.4|1|
|SM 1223 DI16/DQ16 x 24VDC|6ES7 223-1BL32-0XB0|V2.0|2|

### Назначение счетчиков HSC

- HSC_3 – вертикальная ось;
- HSC_4 – горизонтальная ось;
- HSC_5 – вращение платформы.


### Таблица сигналов

|Участок|Имя|Тип сигнала|Адрес|Комментарий|
| - | - | - | - | - |
|VGR|энкодер вертикальной оси A|DI-CNT|%I0.4|энкодер вертикальной оси A|
|VGR|энкодер вертикальной оси B|DI-CNT|%I0.5|энкодер вертикальной оси B|
|VGR|энкодер горизонтальной оси A|DI-CNT|%I0.6|энкодер горизонтальной оси A|
|VGR|энкодер горизонтальной оси B|DI-CNT|%I0.7|энкодер горизонтальной оси B|
|VGR|энкодер поворотной платформы A|DI-CNT|%I1.0|энкодер поворотной платформы A|
|VGR|энкодер поворотной платформы B|DI-CNT|%I1.1|энкодер поворотной платформы B|
|VGR|IX_VGR_RefSwitchVerticalAxis_I1|DI|%I12.0|начальная позиция вертикальной оси|
|VGR|IX_VGR_RefSwitchHorizontalAxis_I2|DI|%I12.1|начальная позиция горизонтальной оси|
|VGR|IX_VGR_RefSwitchRotate_I3|DI|%I12.2|начальная позиция поворотной платформы|
|VGR|QX_VGR_M1_VerticalAxisUp_Q1|DO|%Q13.0|движение вертикальной оси вверх|
|VGR|QX_VGR_M1_VerticalAxisDown_Q2|DO|%Q13.1|движение вертикальной оси вниз|
|VGR|QX_VGR_M2_HorizontalAxisBackward_Q3|DO|%Q13.2|движение горизонтальной оси назад|
|VGR|QX_VGR_M2_HorizontalAxisForward_Q4|DO|%Q13.3|движение горизонтальной оси вперед|
|VGR|QX_VGR_M3_RotateClockwise_Q5|DO|%Q13.4|поворот платформы по часовой стрелке|
|VGR|QX_VGR_M3_RotateCounterclockwise_Q6|DO|%Q13.5|поворот платформы против часовой стрелки|
|VGR|QX_VGR_Compressor_Q7|DO|%Q13.6|компрессор|
|VGR|QX_VGR_ValveVacuum_Q8|DO|%Q13.7|вакуумный захват|
|MPO|IX_MPO_RefSwitchOvenFeederInside_I6|DI|%I8.5|механизм загрузки в печь позиция (внутри)|
|MPO|IX_MPO_RefSwitchOvenFeederOutside_I7|DI|%I8.6|механизм загрузки в печь позиция (снаружи)|
|MPO|QX_MPO_M4_OvenFeederRetract_Q5|DO|%Q8.2|задвинуть держатель заготовки|
|MPO|QX_MPO_M4_OvenFeederExtend_Q6|DO|%Q8.3|выдвинуть держатель заготовки|
|MPO|QX_MPO_Compressor_Q10|DO|%Q8.7|компрессор|
|MPO|QX_MPO_ValveOvenDoor_Q13|DO|%Q9.2|вакуумный насос (присоска)|

### Настройки CPU

- Фильтр каналов DI: 0.2 микросекунды;
- Функция счетчика HSC_3: A/B counter fourfold;
- Функция счетчика HSC_4: A/B counter fourfold;
- Функция счетчика HSC_5: A/B counter fourfold.

## Электронные ресурсы

- [SIEMENS Programming Guideline for S7-1200/S7-1500, V1.5, 03/2017 (90885040)](https://support.industry.siemens.com/cs/document/90885040);
- [Исходный код проекта fischertechnik Training Factory Industry 4.0 24V](https://github.com/fischertechnik/plc_training_factory_24v).
